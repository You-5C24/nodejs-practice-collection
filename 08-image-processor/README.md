# 图片处理服务 (Image Processor)

一个图片处理服务，用于学习文件上传、Stream 和图片处理技术。

## 📖 学习目标

- **文件上传：** Multer 中间件的使用
- **Stream 处理：** 流式处理大文件
- **Buffer 操作：** 二进制数据处理
- **图片处理：** Sharp 库的使用
- **存储管理：** 文件系统和云存储
- **性能优化：** 异步处理和队列

## 🎯 功能特性

### 1. 图片上传
- 单文件上传
- 多文件批量上传
- 文件大小限制
- 文件类型验证

### 2. 图片处理
- 图片压缩
- 格式转换（JPG、PNG、WebP）
- 生成缩略图
- 图片裁剪
- 添加水印
- 调整尺寸

### 3. 存储管理
- 本地文件存储
- 文件命名规则
- 目录结构管理
- 临时文件清理

## 🚀 安装和使用

```bash
# 安装依赖
npm install

# 启动服务
npm start

# 访问服务
# http://localhost:3000
```

## 📡 API 端点

```
POST /api/upload          - 上传图片
POST /api/compress        - 压缩图片
POST /api/resize          - 调整尺寸
POST /api/convert         - 格式转换
POST /api/thumbnail       - 生成缩略图
GET  /api/images/:id      - 获取图片
DELETE /api/images/:id    - 删除图片
```

## 💡 实现要点

1. 使用 Multer 处理文件上传
2. 使用 Sharp 进行图片处理
3. 实现文件验证和安全检查
4. 使用 Stream 处理大文件
5. 实现异步任务队列
6. 清理临时文件

## 📚 相关知识点

- HTTP 文件上传协议
- Multer 中间件
- Sharp 图片处理库
- Stream 和 Buffer
- 文件系统操作
- 异步任务队列
- 内存管理

## 🔗 扩展方向

- 添加云存储支持（AWS S3、阿里云 OSS）
- 实现图片 CDN 加速
- 添加人脸识别功能
- 实现图片智能裁剪
- 添加图片 AI 增强
- 实现批量处理队列
- 添加图片元数据提取
- 实现图片相似度对比

## 🔒 安全考虑

- 验证文件类型
- 限制文件大小
- 防止路径遍历
- 清理文件元数据
- 防止恶意文件上传
- 定期清理临时文件

## ⚡ 性能优化

- 使用流式处理
- 实现图片缓存
- 异步处理任务
- 限制并发处理数量
- 使用 Worker 线程

